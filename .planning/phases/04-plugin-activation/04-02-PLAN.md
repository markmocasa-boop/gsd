---
phase: 04-plugin-activation
plan: 02
type: execute
depends_on: ["04-01"]
files_modified: [bin/plugin.js, commands/gsd/plugin.md, get-shit-done/references/plugin-format.md]
---

<objective>
Integrate plugin commands into the GSD command namespace for discoverability.

Purpose: Make plugin commands appear in `/gsd:help` output and ensure disabled plugins don't expose commands.
Output: Updated help command awareness of plugin commands, clear documentation on command namespace behavior.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan context:
@.planning/phases/04-plugin-activation/04-01-SUMMARY.md

# Existing implementation:
@bin/plugin.js
@commands/gsd/plugin.md
@get-shit-done/references/plugin-format.md

**Tech stack available:** Node.js fs/path/os, existing plugin.js patterns
**Established patterns:**
- Commands install to `~/.claude/commands/{plugin-name}/*.md`
- Commands use `{plugin-name}:{command}` namespace
- Plugin manifest `gsd.commands` array lists available commands
- `_installed.enabled` tracks activation state (from 04-01)

**Constraining decisions:**
- Phase 01-01: Commands use pluginname:command namespace
- Phase 01-02: Commands install to commands/{plugin}/ directory
- Phase 04-01: `_installed.enabled` flag controls activation state
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement listCommands function for plugin command discovery</name>
  <files>bin/plugin.js</files>
  <action>
Add a `listCommands()` function to bin/plugin.js that discovers all plugin commands:

1. Scan `~/.claude/commands/` for subdirectories (skip 'gsd' - that's core)
2. For each subdirectory, check if corresponding plugin is enabled:
   - Read `~/.claude/{dirname}/plugin.json`
   - Check `_installed.enabled !== false` (default true)
3. If enabled, extract commands from manifest `gsd.commands` array
4. Return array of command objects: `{name, description, plugin, file}`

Add a `showCommands()` function that displays discovered commands:
1. Call `listCommands()`
2. Group by plugin name
3. Display format:
   ```
   Plugin Commands:

   {plugin-name}:
     /{command-name} - {description}
     /{command-name} - {description}

   {another-plugin}:
     /{command-name} - {description}
   ```
4. If no plugin commands, show "No plugin commands installed."

Add 'commands' case to switch statement:
```javascript
case 'commands':
  showCommands();
  break;
```

Update showHelp() to include:
- `plugin commands          List all plugin commands`
  </action>
  <verify>
```bash
node bin/plugin.js --help | grep "commands"
```
Should show "plugin commands" in help output.
  </verify>
  <done>listCommands() discovers enabled plugin commands, showCommands() displays them grouped by plugin, 'commands' subcommand wired in CLI</done>
</task>

<task type="auto">
  <name>Task 2: Update documentation with command namespace behavior</name>
  <files>commands/gsd/plugin.md, get-shit-done/references/plugin-format.md</files>
  <action>
1. Update commands/gsd/plugin.md:
   - Add `/gsd:plugin commands` to overview
   - Add process section for commands action
   - Add example output showing grouped plugin commands
   - Add note: "Disabled plugins don't expose commands"

2. Update get-shit-done/references/plugin-format.md:
   - Add section `<activation_behavior>` explaining:
     - Plugins are enabled by default on install
     - `_installed.enabled` flag controls activation
     - Disabled plugins: commands hidden, hooks don't fire, services don't start
     - Enable/disable doesn't remove files (unlike uninstall)
   - Update services_overview to mention enabled/disabled lifecycle
   - Add example of enable/disable workflow

3. Ensure documentation is clear that:
   - `/gsd:plugin list` shows all plugins with enabled/disabled status
   - `/gsd:plugin commands` shows only commands from enabled plugins
   - Users can use `/pluginname:command` directly when enabled
  </action>
  <verify>
Check documentation updates:
```bash
grep -l "enabled" commands/gsd/plugin.md get-shit-done/references/plugin-format.md | wc -l
```
Should return 2 (both files mention enabled state).
  </verify>
  <done>plugin.md documents commands subcommand, plugin-format.md explains activation behavior, clear distinction between list and commands output</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `node bin/plugin.js commands` runs without error
- [ ] `node bin/plugin.js --help` shows all 6 subcommands (install, uninstall, list, info, enable, disable, commands)
- [ ] Documentation explains enabled/disabled behavior
- [ ] Phase 4 (Plugin Activation) is complete
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors in plugin.js execution
- Plugin commands discoverable when enabled
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-plugin-activation/04-02-SUMMARY.md`
</output>
