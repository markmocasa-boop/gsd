---
phase: 01-foundation-data-profiling
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - frontend/package.json
  - frontend/next.config.ts
  - frontend/tsconfig.json
  - frontend/tailwind.config.ts
  - frontend/src/app/layout.tsx
  - frontend/src/app/page.tsx
  - frontend/src/app/(dashboard)/sources/page.tsx
  - frontend/src/app/(dashboard)/sources/new/page.tsx
  - frontend/src/app/(dashboard)/profiles/page.tsx
  - frontend/src/app/(dashboard)/profiles/[id]/page.tsx
  - frontend/src/components/ui/button.tsx
  - frontend/src/components/ui/card.tsx
  - frontend/src/components/ui/input.tsx
  - frontend/src/components/ui/select.tsx
  - frontend/src/components/ui/table.tsx
  - frontend/src/components/features/sources/source-form.tsx
  - frontend/src/components/features/sources/source-list.tsx
  - frontend/src/components/features/profiles/profile-summary.tsx
  - frontend/src/components/features/profiles/column-stats.tsx
  - frontend/src/components/features/profiles/anomaly-list.tsx
  - frontend/src/lib/supabase.ts
  - frontend/src/lib/api.ts
  - frontend/src/hooks/use-sources.ts
  - frontend/src/hooks/use-profiles.ts
autonomous: true

must_haves:
  truths:
    - "User can view list of connected data sources"
    - "User can add new data source connection (Iceberg, Redshift, or Athena)"
    - "User can view profile results with column statistics"
    - "User can see detected anomalies with severity indicators"
  artifacts:
    - path: "frontend/src/app/(dashboard)/sources/page.tsx"
      provides: "Data source list view"
      min_lines: 30
    - path: "frontend/src/app/(dashboard)/profiles/[id]/page.tsx"
      provides: "Profile detail view with statistics"
      min_lines: 50
    - path: "frontend/src/components/features/profiles/column-stats.tsx"
      provides: "Column statistics display component"
      exports: ["ColumnStats"]
    - path: "frontend/src/components/features/profiles/anomaly-list.tsx"
      provides: "Anomaly list with severity"
      exports: ["AnomalyList"]
  key_links:
    - from: "frontend/src/hooks/use-sources.ts"
      to: "Supabase"
      via: "TanStack Query + Supabase client"
      pattern: "useQuery.*supabase.*from.*data_sources"
    - from: "frontend/src/app/(dashboard)/profiles/[id]/page.tsx"
      to: "use-profiles.ts"
      via: "hook import"
      pattern: "useProfile\\(id\\)"
---

<objective>
Build the Next.js frontend for data source management and profile visualization.

Purpose: Create the user interface that allows users to connect data sources and view profiling results, completing the end-to-end user experience for Phase 1.

Output: Working Next.js application with source management pages and profile viewer components.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-data-profiling/01-RESEARCH.md
@.planning/phases/01-foundation-data-profiling/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Next.js Project Setup</name>
  <files>
    frontend/package.json
    frontend/next.config.ts
    frontend/tsconfig.json
    frontend/tailwind.config.ts
    frontend/postcss.config.js
    frontend/src/app/layout.tsx
    frontend/src/app/page.tsx
    frontend/src/lib/supabase.ts
    frontend/src/lib/api.ts
    frontend/src/app/providers.tsx
    frontend/.env.example
  </files>
  <action>
    Initialize Next.js 15 project with required dependencies:

    **package.json:**
    - Next.js 15 with App Router
    - React 19
    - TanStack Query v5 (@tanstack/react-query)
    - Supabase client (@supabase/supabase-js)
    - Tailwind CSS
    - Zod for validation
    - Recharts for visualizations
    - clsx and tailwind-merge for class utilities

    **next.config.ts:**
    - Standard Next.js 15 config
    - Environment variable validation

    **tailwind.config.ts:**
    - Configure content paths for src directory
    - shadcn/ui compatible theme setup

    **src/lib/supabase.ts:**
    - Create browser client using createBrowserClient
    - Export typed Supabase client
    - Database types placeholder (will be generated from schema)

    **src/lib/api.ts:**
    - API helper functions for backend calls
    - Base URL from environment variable
    - Typed fetch wrappers with error handling

    **src/app/providers.tsx:**
    - QueryClientProvider setup for TanStack Query
    - Client-side only (use 'use client')

    **src/app/layout.tsx:**
    - Root layout with Providers wrapper
    - Basic metadata
    - Tailwind base styles

    **src/app/page.tsx:**
    - Redirect to /sources (main dashboard entry)

    **.env.example:**
    - NEXT_PUBLIC_SUPABASE_URL
    - NEXT_PUBLIC_SUPABASE_ANON_KEY
    - NEXT_PUBLIC_API_URL

    Run `npx shadcn@latest init` configuration (or manually create base components).
  </action>
  <verify>
    cd frontend && npm install && npm run build
    # Next.js builds successfully
  </verify>
  <done>
    Next.js 15 project builds successfully. TanStack Query and Supabase clients configured. Tailwind CSS working.
  </done>
</task>

<task type="auto">
  <name>Task 2: Data Source Management UI</name>
  <files>
    frontend/src/app/(dashboard)/layout.tsx
    frontend/src/app/(dashboard)/sources/page.tsx
    frontend/src/app/(dashboard)/sources/new/page.tsx
    frontend/src/app/(dashboard)/sources/[id]/page.tsx
    frontend/src/components/ui/button.tsx
    frontend/src/components/ui/card.tsx
    frontend/src/components/ui/input.tsx
    frontend/src/components/ui/select.tsx
    frontend/src/components/ui/table.tsx
    frontend/src/components/features/sources/source-form.tsx
    frontend/src/components/features/sources/source-list.tsx
    frontend/src/hooks/use-sources.ts
  </files>
  <action>
    Create data source management pages and components:

    **src/app/(dashboard)/layout.tsx:**
    - Dashboard layout with sidebar navigation
    - Links: Sources, Profiles
    - Simple header with app name

    **src/hooks/use-sources.ts:**
    - `useSources()`: TanStack Query hook to list data_sources from Supabase
    - `useSource(id)`: Get single source with datasets
    - `useCreateSource()`: Mutation to create new source
    - `useDeleteSource()`: Mutation to delete source
    - Proper query key management for cache invalidation

    **src/components/features/sources/source-list.tsx:**
    - Table displaying sources: name, type, database count, created date
    - Click row to navigate to source detail
    - Delete button with confirmation
    - Loading and empty states

    **src/components/features/sources/source-form.tsx:**
    - Form for creating/editing data source
    - Fields: name (text), source_type (select: iceberg/redshift/athena)
    - Dynamic connection params based on source_type:
      - Iceberg: region, catalog_name
      - Redshift: workgroup, region
      - Athena: region, output_location
    - Database and table name fields
    - Zod validation
    - Submit creates source AND dataset in transaction

    **src/app/(dashboard)/sources/page.tsx:**
    - Page component using SourceList
    - "Add Source" button linking to /sources/new

    **src/app/(dashboard)/sources/new/page.tsx:**
    - Page with SourceForm
    - On success, redirect to /sources

    **src/app/(dashboard)/sources/[id]/page.tsx:**
    - Source detail view
    - Show connection info
    - List datasets for this source
    - "Run Profile" button for each dataset
    - Link to latest profile results

    **UI components (shadcn-style):**
    - Button: variants (default, destructive, outline, ghost)
    - Card: container with header, content, footer
    - Input: styled text input with label
    - Select: dropdown with options
    - Table: header, body, row, cell components

    Use Tailwind classes. Components should be composable and accessible.
  </action>
  <verify>
    cd frontend && npm run build
    # Check components exist and export correctly
    grep -l "export" frontend/src/components/features/sources/*.tsx | wc -l
    # Should be 2 (source-form, source-list)
  </verify>
  <done>
    Source management pages render without errors. Form validates input. List displays sources with actions. CRUD operations work via Supabase.
  </done>
</task>

<task type="auto">
  <name>Task 3: Profile Viewer Components</name>
  <files>
    frontend/src/app/(dashboard)/profiles/page.tsx
    frontend/src/app/(dashboard)/profiles/[id]/page.tsx
    frontend/src/components/features/profiles/profile-summary.tsx
    frontend/src/components/features/profiles/column-stats.tsx
    frontend/src/components/features/profiles/anomaly-list.tsx
    frontend/src/components/features/profiles/distribution-chart.tsx
    frontend/src/hooks/use-profiles.ts
  </files>
  <action>
    Create profile viewing pages and components:

    **src/hooks/use-profiles.ts:**
    - `useProfiles(datasetId?)`: List profile_runs, optionally filtered by dataset
    - `useProfile(id)`: Get single profile with full results (profile_results, column_profiles, profile_anomalies)
    - `useTriggerProfile()`: Mutation to POST to /api/profiles and start profiling
    - Poll for status updates when profile is 'running' (refetchInterval: 5000 while running)

    **src/components/features/profiles/profile-summary.tsx:**
    - Card showing profile overview:
      - Table name, row count, column count
      - Sampled indicator if applicable
      - Profile timestamp
      - Status badge (pending/running/completed/failed)
    - Link to full S3 profile if available

    **src/components/features/profiles/column-stats.tsx:**
    - Table of column statistics:
      - Column name, inferred type
      - Null count and percentage (with color coding: green <5%, yellow 5-20%, red >20%)
      - Distinct count and percentage
      - For numeric: min, max, mean, median, std dev
      - For categorical: top 3 values with percentages
    - Sortable by column name or null percentage
    - Expandable rows for detailed stats

    **src/components/features/profiles/anomaly-list.tsx:**
    - List of detected anomalies:
      - Severity badge (info=blue, warning=yellow, critical=red)
      - Column name
      - Anomaly type and description
      - Value and threshold if applicable
    - Filter by severity
    - Empty state: "No anomalies detected"

    **src/components/features/profiles/distribution-chart.tsx:**
    - Recharts bar chart for numeric column distribution
    - Props: column_name, histogram_data (bins and counts)
    - Responsive sizing
    - Tooltip showing exact values

    **src/app/(dashboard)/profiles/page.tsx:**
    - List of recent profile runs across all datasets
    - Filter by status
    - Click to view details

    **src/app/(dashboard)/profiles/[id]/page.tsx:**
    - Full profile detail page:
      - ProfileSummary at top
      - Tabs or sections: Column Stats, Anomalies
      - ColumnStats component with all columns
      - AnomalyList component
      - DistributionChart for selected numeric column (optional click interaction)
    - Loading state while fetching
    - Error state if profile not found or failed

    Use TanStack Query for all data fetching. Ensure proper loading/error states.
  </action>
  <verify>
    cd frontend && npm run build
    # Check all profile components exist
    ls frontend/src/components/features/profiles/*.tsx | wc -l
    # Should be 4 (profile-summary, column-stats, anomaly-list, distribution-chart)
  </verify>
  <done>
    Profile viewer pages render without errors. Column statistics display with proper formatting. Anomaly list shows severity-coded items. Distribution charts render for numeric columns.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` succeeds
2. All pages render at their routes (check via dev server)
3. Source CRUD operations work with Supabase (manual test with real connection)
4. Profile viewer displays mock data correctly
5. Responsive design works on mobile viewport
</verification>

<success_criteria>
- Next.js 15 project with App Router structure
- Data source list page shows connected sources
- Add source form with type-specific connection fields
- Profile list shows recent profiling runs with status
- Profile detail shows: summary card, column statistics table, anomaly list
- Column stats display completeness (nulls), distribution metrics (min/max/mean/median/std)
- Anomalies show severity-coded badges
- TanStack Query manages server state with caching
- UI is responsive and accessible
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-data-profiling/01-03-SUMMARY.md`
</output>
