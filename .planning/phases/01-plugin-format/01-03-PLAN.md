---
phase: 01-plugin-format
plan: 03
type: execute
depends_on: ["01-01"]
files_modified: [get-shit-done/references/plugin-hooks.md, get-shit-done/templates/plugin/hooks/example-hook.md]
---

<objective>
Define the plugin hooks and lifecycle events that plugins can respond to.

Purpose: Hooks allow plugins to integrate with GSD workflows at key points (e.g., after research, before phase execution). This enables the Neo4j knowledge graph plugin to capture research data passively.

Output:
- `get-shit-done/references/plugin-hooks.md` - Hook specification and event catalog
- `get-shit-done/templates/plugin/hooks/example-hook.md` - Template hook handler
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/codebase/ARCHITECTURE.md
@.planning/phases/01-plugin-format/01-01-SUMMARY.md

**Motivating use case (from PROJECT.md):**
Neo4j knowledge graph plugin that:
- Passively captures research/discovery data from all projects
- Hooks into GSD workflows (capture research data)

**Existing GSD lifecycle points (from ARCHITECTURE.md):**
- Initialization: `/gsd:new-project` creates PROJECT.md
- Planning: `/gsd:plan-phase` creates PLAN.md
- Execution: `/gsd:execute-phase` runs plans via subagents
- Verification: gsd-verifier checks must-haves
- Research: `/gsd:research-phase` produces RESEARCH.md

**Hook points to define:**
- post-research: After RESEARCH.md created
- post-plan: After PLAN.md created
- pre-execute: Before plan execution starts
- post-execute: After plan execution completes
- post-summary: After SUMMARY.md created
- post-verify: After verification completes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define hook specification</name>
  <files>get-shit-done/references/plugin-hooks.md</files>
  <action>
Create `get-shit-done/references/plugin-hooks.md` documenting:

**Overview:**
- What hooks are (integration points in GSD lifecycle)
- How they work (GSD checks for registered hooks, invokes handlers)
- When to use hooks vs commands (hooks = passive integration, commands = explicit invocation)

**Hook Registration (in plugin.json):**
```json
{
  "gsd": {
    "hooks": {
      "post-research": "hooks/capture-research.md",
      "post-summary": "hooks/index-summary.md"
    }
  }
}
```

**Available Lifecycle Events:**

| Event | Triggered When | Context Passed |
|-------|----------------|----------------|
| `post-project-init` | After PROJECT.md created | project_path, project_name |
| `post-roadmap` | After ROADMAP.md created | roadmap_path, phases |
| `post-research` | After RESEARCH.md created | research_path, phase |
| `post-plan` | After PLAN.md created | plan_path, phase, plan_number |
| `pre-execute` | Before plan execution | plan_path, phase, plan_number |
| `post-execute` | After plan execution | summary_path, phase, plan_number, success |
| `post-verify` | After phase verification | verification_path, phase, passed |
| `post-milestone` | After milestone completed | milestone_name, phases_completed |

**Hook Handler Structure:**
Hook handler files are markdown prompts (like commands) that receive context via a `<hook_context>` XML block:

```markdown
---
hook: post-research
description: Captures research findings into knowledge graph
---

<hook_context>
<!-- Injected by GSD at invocation time -->
research_path: .planning/phases/02-auth/02-RESEARCH.md
phase: 02-auth
project_path: /path/to/project
</hook_context>

<process>
1. Read the research file at {research_path}
2. Extract key findings, decisions, patterns
3. [Plugin-specific processing]
</process>
```

**Execution Model:**
- Hooks run synchronously after the triggering event
- Hook failures are logged but don't block GSD workflow
- Multiple plugins can register for same event (executed in plugin load order)

**Anti-patterns:**
- Don't use hooks for user-facing actions (use commands)
- Don't make hooks blocking on external services (use async where possible)
- Don't modify GSD core files from hooks

Keep focused on specification - actual hook invocation mechanism is Phase 4 (activation).
  </action>
  <verify>cat get-shit-done/references/plugin-hooks.md | grep -c "post-research" (event documented)</verify>
  <done>plugin-hooks.md exists with lifecycle events catalog</done>
</task>

<task type="auto">
  <name>Task 2: Create hook handler template</name>
  <files>get-shit-done/templates/plugin/hooks/example-hook.md</files>
  <action>
Create `get-shit-done/templates/plugin/hooks/example-hook.md` as a template showing:

```markdown
---
hook: [EVENT_NAME]
description: [What this hook does]
---

<objective>
[What this hook accomplishes when triggered]
</objective>

<hook_context>
<!-- This block is injected by GSD at runtime -->
<!-- Available variables depend on the hook event -->
</hook_context>

<process>
1. [Step 1 - typically read context files]
2. [Step 2 - process/transform data]
3. [Step 3 - store/output results]
</process>

<error_handling>
[How to handle failures gracefully without blocking GSD]
</error_handling>
```

Include a concrete example for `post-research` hook that would:
1. Read the RESEARCH.md file
2. Extract structured data (libraries, patterns, decisions)
3. Log to a plugin-specific file (demonstrating non-blocking behavior)

This template helps plugin authors understand hook structure without implementing full Neo4j integration (that's a plugin, not core GSD).
  </action>
  <verify>cat get-shit-done/templates/plugin/hooks/example-hook.md | head -30</verify>
  <done>Example hook template exists with post-research example</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `get-shit-done/references/plugin-hooks.md` exists with event catalog
- [ ] `get-shit-done/templates/plugin/hooks/example-hook.md` exists
- [ ] All 8 lifecycle events documented
- [ ] Hook handler structure matches GSD command patterns
- [ ] Neo4j use case (passive research capture) is clearly supported
</verification>

<success_criteria>

- Hook system specification complete
- All lifecycle events catalogued with context variables
- Hook handler template follows GSD patterns
- Phase 4 (activation) has clear spec to implement hook invocation
</success_criteria>

<output>
After completion, create `.planning/phases/01-plugin-format/01-03-SUMMARY.md`
</output>
