---
phase: 02-plugin-installation
plan: 03
type: execute
depends_on: ["02-02"]
files_modified: [bin/plugin.js, commands/gsd/plugin.md]
---

<objective>
Implement plugin uninstall command that cleanly removes all installed files and handles linked plugins.

Purpose: Allow users to cleanly remove plugins and recover from bad installations.
Output: Working uninstall command that removes all plugin files while preserving other plugins and GSD core.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-plugin-installation/02-01-SUMMARY.md
@.planning/phases/02-plugin-installation/02-02-SUMMARY.md
@get-shit-done/references/plugin-format.md
@bin/plugin.js

**From 02-01 and 02-02:**
- Plugins install to ~/.claude/{plugin-name}/ with plugin.json preserved
- Commands install to ~/.claude/commands/{plugin-name}/
- Agents install to ~/.claude/agents/ (individual files)
- Linked plugins have "linked: true" in their manifest
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement basic uninstall command</name>
  <files>bin/plugin.js</files>
  <action>
Add `uninstall <plugin-name>` subcommand to bin/plugin.js.

Implementation:
1. Parse `uninstall` subcommand with plugin name argument
2. Locate plugin: ~/.claude/{plugin-name}/plugin.json
3. If not found, error: "Plugin {name} is not installed"
4. Read manifest to identify all installed files
5. Remove files in reverse of installation order:
   - Remove ~/.claude/commands/{plugin-name}/ (entire directory)
   - Remove agent files from ~/.claude/agents/ (only files from this plugin)
   - Remove ~/.claude/{plugin-name}/ (entire directory including plugin.json)

Agent file removal (careful - shared directory):
```javascript
// Read manifest to get agent files
const agents = manifest.gsd?.agents || [];
for (const agent of agents) {
  const agentFile = path.join(claudeDir, 'agents', path.basename(agent.file));
  if (fs.existsSync(agentFile)) {
    fs.unlinkSync(agentFile);
  }
}
```

Output:
```
Uninstalling plugin: my-plugin v1.0.0
  ✓ Removed commands/my-plugin/
  ✓ Removed agents/my-plugin-indexer.md
  ✓ Removed my-plugin/

Done! Plugin my-plugin has been uninstalled.
```

Error cases:
- Plugin not installed: "Error: Plugin {name} is not installed"
- Name empty: "Error: Plugin name required. Usage: plugin uninstall <name>"
  </action>
  <verify>Install a test plugin, then run `node bin/plugin.js uninstall test-plugin` and verify all files removed</verify>
  <done>Uninstall command removes all plugin files, preserves other plugins, clear output</done>
</task>

<task type="auto">
  <name>Task 2: Handle linked plugins and edge cases</name>
  <files>bin/plugin.js</files>
  <action>
Handle linked plugins and edge cases in uninstall.

Linked plugin handling:
1. Check manifest for "linked: true" flag
2. For linked plugins, remove symlinks only (not source files)
3. Warn user that source files remain: "Note: Source files at {original-path} were not modified"

Track original path for linked plugins:
- During install --link, store "linkedFrom: /original/path" in manifest
- During uninstall, show this path in the note

Edge cases:
1. Partial installation (some files missing):
   - Continue removing what exists
   - Warn about missing expected files
   - Don't error, just report

2. Corrupted plugin.json:
   - If JSON parse fails, offer --force to remove directory anyway
   - "Error: Corrupted plugin.json. Use --force to remove anyway."

3. Permission errors:
   - Catch EACCES/EPERM errors
   - "Error: Permission denied removing {path}. Check file permissions."

4. Files modified after install:
   - Don't check, just remove (user chose to uninstall)
   - Optionally with --dry-run, list what would be removed

Add --dry-run flag:
```
node bin/plugin.js uninstall my-plugin --dry-run

Would uninstall: my-plugin v1.0.0
  - ~/.claude/commands/my-plugin/
  - ~/.claude/agents/my-plugin-indexer.md
  - ~/.claude/my-plugin/

Run without --dry-run to actually uninstall.
```
  </action>
  <verify>Test uninstalling a linked plugin (should only remove symlinks), test --dry-run (should not delete anything)</verify>
  <done>Linked plugins handled correctly, edge cases covered, --dry-run works</done>
</task>

<task type="auto">
  <name>Task 3: Update /gsd:plugin command with uninstall support</name>
  <files>commands/gsd/plugin.md</files>
  <action>
Update the gsd:plugin command to support uninstall.

Update commands/gsd/plugin.md:

```markdown
---
name: gsd:plugin
description: Manage GSD plugins (install, uninstall, list)
argument-hint: "<action> [source|name]"
allowed-tools: [Bash, Read]
---

<overview>
Plugin management for GSD. Install, uninstall, and manage plugins.

**Commands:**
- `/gsd:plugin install <git-url>` - Install from git repository
- `/gsd:plugin install <local-path>` - Install from local folder
- `/gsd:plugin install <path> --link` - Link for development (changes reflect immediately)
- `/gsd:plugin uninstall <name>` - Remove an installed plugin
- `/gsd:plugin uninstall <name> --dry-run` - Preview what would be removed
- `/gsd:plugin list` - List installed plugins (Phase 3)
</overview>

<process>
Parse the user's command and execute the appropriate action.

**For install:**
1. Determine if source is git URL (contains github.com, gitlab.com, or starts with git@)
2. Determine if --link flag present (local development mode)
3. Run: `node ~/.claude/get-shit-done/bin/plugin.js install <source> [--link] [--force]`
4. Report results

**For uninstall:**
1. Extract plugin name
2. Determine if --dry-run flag present
3. Run: `node ~/.claude/get-shit-done/bin/plugin.js uninstall <name> [--dry-run]`
4. Report results

**For list:**
Tell user this command is coming in Phase 3.

**Error handling:**
If the plugin.js command fails, show the error output to the user.
</process>

<examples>
Install from GitHub:
\`/gsd:plugin install https://github.com/user/my-gsd-plugin\`

Install local for development:
\`/gsd:plugin install ./my-plugin --link\`

Uninstall:
\`/gsd:plugin uninstall my-plugin\`

Preview uninstall:
\`/gsd:plugin uninstall my-plugin --dry-run\`
</examples>
```
  </action>
  <verify>Read commands/gsd/plugin.md and verify uninstall documentation is complete</verify>
  <done>Command updated with uninstall support, examples included, clear usage documentation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `node bin/plugin.js uninstall <name>` removes plugin files
- [ ] Uninstalling linked plugin removes symlinks only
- [ ] --dry-run shows what would be removed without removing
- [ ] Missing plugin gives clear error message
- [ ] commands/gsd/plugin.md documents uninstall command
</verification>

<success_criteria>
- Uninstall cleanly removes all plugin files
- Linked plugins handled correctly (symlinks removed, source preserved)
- Edge cases (corrupted, partial, permissions) handled gracefully
- --dry-run provides safe preview
- Command documentation complete
- Phase 2: Plugin Installation is complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-plugin-installation/02-03-SUMMARY.md`:

# Phase 2 Plan 03: Plugin Uninstall Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `bin/plugin.js` - Added uninstall command
- `commands/gsd/plugin.md` - Updated with uninstall docs

## Decisions Made
- [Any decisions]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- Phase 2 complete
- Ready for Phase 3: Plugin Discovery
</output>
