---
phase: 02-plugin-installation
plan: 01
type: execute
depends_on: []
files_modified: [bin/plugin.js, commands/gsd/plugin.md]
---

<objective>
Implement the core plugin installation command that clones git repositories into the plugins directory.

Purpose: Enable users to install plugins from git repos with a single command (`/gsd:plugin install <git-url>`).
Output: Working plugin install command that clones repos, validates manifests, and copies files to correct locations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-plugin-format/01-01-SUMMARY.md
@.planning/phases/01-plugin-format/01-02-SUMMARY.md
@get-shit-done/references/plugin-format.md
@bin/install.js

**Constraining decisions from Phase 1:**
- Manifest uses JSON (plugin.json) - must parse and validate
- Commands install to `~/.claude/commands/{plugin-name}/` for namespacing
- Other files install under `~/.claude/{plugin-name}/` namespace
- Validation rules: kebab-case names, semver versions, relative paths, command prefix matches plugin name

**Installation mapping (from plugin-format.md):**
| Plugin Path | Installed To |
|-------------|--------------|
| `commands/*.md` | `~/.claude/commands/{plugin-name}/*.md` |
| `agents/*.md` | `~/.claude/agents/*.md` |
| `workflows/*.md` | `~/.claude/{plugin-name}/workflows/*.md` |
| `templates/*.md` | `~/.claude/{plugin-name}/templates/*.md` |
| `references/*.md` | `~/.claude/{plugin-name}/references/*.md` |
| `hooks/*.md` | `~/.claude/{plugin-name}/hooks/*.md` |
| `docker/*` | `~/.claude/{plugin-name}/docker/*` |

**Constraint: Zero npm dependencies** - Use only Node.js built-ins (fs, path, os, child_process).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create plugin CLI entry point with install command</name>
  <files>bin/plugin.js</files>
  <action>
Create `bin/plugin.js` as the CLI entry point for plugin management. Follow the pattern from `bin/install.js`.

Structure:
1. Shebang and require statements (fs, path, os, child_process)
2. Color constants for terminal output
3. Parse arguments: `plugin install <source>` where source is git URL or local path
4. `install` subcommand:
   - Accept git URL (https:// or git@) or local path
   - If git URL: clone to temp directory, validate, copy files, cleanup temp
   - If local path: validate, copy files (delegate to 02-02)
   - Use `child_process.execSync` to run `git clone --depth 1` (shallow clone for speed)
5. Clone to temp dir: `os.tmpdir()/gsd-plugin-{random}`
6. After clone, validate plugin.json exists and is valid JSON
7. Copy files per installation mapping
8. Cleanup: remove temp clone directory
9. Report success with installed commands list

Git clone implementation:
```javascript
const { execSync } = require('child_process');
const tempDir = path.join(os.tmpdir(), `gsd-plugin-${Date.now()}`);
execSync(`git clone --depth 1 ${gitUrl} ${tempDir}`, { stdio: 'inherit' });
```

Error handling:
- Git not installed: "Error: git is required for plugin installation"
- Clone fails: "Error: Failed to clone {url}"
- No plugin.json: "Error: Not a valid GSD plugin (missing plugin.json)"
- Invalid JSON: "Error: Invalid plugin.json - {parse error}"

Do NOT implement full validation yet - just check plugin.json exists and parses. Full validation in Task 2.
  </action>
  <verify>node bin/plugin.js install https://github.com/test/repo shows appropriate error (no such repo) but doesn't crash</verify>
  <done>bin/plugin.js exists, accepts `install <url>` command, attempts git clone, handles missing git gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Implement manifest validation and file copying</name>
  <files>bin/plugin.js</files>
  <action>
Add manifest validation and file installation logic to bin/plugin.js.

Validation (from plugin-format.md validation_rules):
1. Name: kebab-case only, 3-50 chars, starts with letter, lowercase/numbers/hyphens only
   - Regex: `/^[a-z][a-z0-9-]{2,49}$/`
2. Version: semver format MAJOR.MINOR.PATCH
   - Regex: `/^\d+\.\d+\.\d+$/`
3. Required fields: name, version, description, author
4. If gsd.commands exists, validate each:
   - name format: `{pluginName}:{command}` where pluginName matches manifest name
   - file exists in plugin folder
5. File paths: no absolute paths, no `..` traversal

File copying (reuse pattern from install.js `copyWithPathReplacement`):
1. Determine Claude config dir (same logic as install.js - check CLAUDE_CONFIG_DIR env, fallback to ~/.claude)
2. For each category:
   - commands/*.md -> ~/.claude/commands/{plugin-name}/*.md
   - agents/*.md -> ~/.claude/agents/*.md (root level for subagent discovery)
   - workflows/*.md -> ~/.claude/{plugin-name}/workflows/*.md
   - templates/*.md -> ~/.claude/{plugin-name}/templates/*.md
   - references/*.md -> ~/.claude/{plugin-name}/references/*.md
   - hooks/*.md -> ~/.claude/{plugin-name}/hooks/*.md
   - docker/* -> ~/.claude/{plugin-name}/docker/*
3. Copy plugin.json to ~/.claude/{plugin-name}/plugin.json (for later listing/management)
4. Replace path references in .md files (like install.js does)

Track installed files for uninstall (save manifest + file list to ~/.claude/{plugin-name}/plugin.json).

Output on success:
```
Installing plugin: {name} v{version}
  ✓ Validated plugin.json
  ✓ Installed commands: {list}
  ✓ Installed {n} files to ~/.claude/{plugin-name}/

Done! Run /gsd:help to see new commands.
```
  </action>
  <verify>Create a minimal test plugin folder locally, run `node bin/plugin.js install ./test-plugin` and verify files are copied to ~/.claude/</verify>
  <done>Plugin validation works, files copy to correct locations, success message shows installed commands</done>
</task>

<task type="auto">
  <name>Task 3: Create /gsd:plugin command wrapper</name>
  <files>commands/gsd/plugin.md</files>
  <action>
Create the GSD command that wraps the plugin CLI.

```markdown
---
name: gsd:plugin
description: Manage GSD plugins (install, uninstall, list)
argument-hint: "<action> [source]"
allowed-tools: [Bash, Read]
---

<overview>
Plugin management for GSD. Install plugins from git repositories or local paths.

**Usage:**
- `/gsd:plugin install <git-url>` - Install from git repo
- `/gsd:plugin install <local-path>` - Install from local folder
- `/gsd:plugin list` - List installed plugins (Phase 3)
- `/gsd:plugin uninstall <name>` - Remove plugin (Phase 3)
</overview>

<process>
Parse the user's command and execute the appropriate action.

**For install:**
1. Extract source (git URL or local path)
2. Run: `node ~/.claude/get-shit-done/bin/plugin.js install <source>`
3. Report results to user

**For list/uninstall:**
Tell user these commands are not yet implemented (coming in Phase 3).
</process>
```

Note: The bin/plugin.js should be copied during GSD installation (like other GSD files). Add it to the install.js copy targets.

Also update bin/install.js to copy bin/plugin.js to ~/.claude/get-shit-done/bin/plugin.js.
  </action>
  <verify>Check commands/gsd/plugin.md exists with correct frontmatter</verify>
  <done>Command file exists, references plugin.js correctly, has proper argument-hint</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `node bin/plugin.js --help` shows usage
- [ ] `node bin/plugin.js install` with no args shows error
- [ ] `node bin/plugin.js install <invalid-url>` shows git error
- [ ] Local path install works with test plugin
- [ ] commands/gsd/plugin.md exists with valid frontmatter
</verification>

<success_criteria>
- bin/plugin.js CLI works for git URL and local path installation
- Manifest validation catches invalid plugins
- Files install to correct locations per mapping
- /gsd:plugin command wrapper exists
- No npm dependencies added
</success_criteria>

<output>
After completion, create `.planning/phases/02-plugin-installation/02-01-SUMMARY.md`:

# Phase 2 Plan 01: Plugin Install Command Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `bin/plugin.js` - Plugin CLI
- `commands/gsd/plugin.md` - Command wrapper

## Decisions Made
- [Any decisions]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- Ready for 02-02 (local path refinement) and 02-03 (uninstall)
</output>
